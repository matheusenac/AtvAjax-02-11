<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promises</title>
</head>

<body>
    <div id="demo">
        <h1>The fetch API with Promises</h1>
        <input type="text" name="cep" id="cep" placeholder="Digite seu CEP">
        <button type="button" onclick="cepConsulta()">Pesquisar CEP</button>
        <br>
        <input type="text" id="logradouro" placeholder="Logradouro">
        <br>
        <input type="text" id="complemento" placeholder="Complemento">
        <br>
        <input type="text" id="bairro" placeholder="Bairro">
        <br>
        <input type="text" id="localidade" placeholder="Cidade">
        <br>
        <input type="text" id="uf" placeholder="UF">
    </div>
</body>
<script>
    function cepConsulta(){
        let cep = document.getElementById("cep").value
        fetch(`https://viacep.com.br/ws/${cep}/json`)
        //Primeiro then - O primeiro recebe a promessa metadado da resposta
        .then(response => {
            if(!response.ok){
                throw new Error(`Erro HTTP! Status: ${response.status}`)
            }
            return response.json()
        })
        // segundo then recebe os dados e parseia eles 
        .then(dt =>{
            if(dt.erro){
                throw new Error(`CEP INVALIDO! Favor entrar um CEP VÃLIDO. `)
            }
            document.getElementById("logradouro").value = dt.logradouro
            document.getElementById("complemento").value = dt.complemento
            document.getElementById("bairro").value = dt.bairro
            document.getElementById("localidade").value = dt.localidade
            document.getElementById("uf").value = dt.uf

        })
        .catch(error => {
            console.error(`Erro:`, error.message)
        })
    }
</script>
</html>